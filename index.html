 <!DOCTYPE html>
  <html lang="pt-BR">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ORION PDV</title>
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>
  </head>
  <body>
      <header>
          <div class="logo">
              <i class="fas fa-store"></i>
              <h1>ORION PDV</h1>
          </div>
          <div class="user-info">
              <span id="username">Usuário</span>
              <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Sair</button>
          </div>
      </header>

      <main class="main-container">
          <!-- Menu lateral -->
          <aside class="sidebar">
              <nav>
                  <ul>
                      <li class="menu-item active" data-view="pos-view">
                          <i class="fas fa-cash-register"></i>
                          <span>Vendas</span>
                      </li>
                      <li class="menu-item" data-view="produtos-view">
                          <i class="fas fa-box"></i>
                          <span>Produtos</span>
                      </li>
                      <li class="menu-item" data-view="relatorios-view">
                          <i class="fas fa-chart-bar"></i>
                          <span>Relatórios</span>
                      </li>
                      <li class="menu-item" data-view="configuracoes-view">
                          <i class="fas fa-cog"></i>
                          <span>Configurações</span>
                      </li>
                  </ul>
              </nav>
          </aside>

          <!-- Conteúdo -->
          <div class="content">
              <!-- Tela de Vendas (PDV) -->
              <div id="pos-view" class="view active">
                  <div class="view-header">
                      <h2>Ponto de Venda</h2>
                      <div class="actions">
                          <button id="barcode-btn" class="btn"><i class="fas fa-barcode"></i> Scanner</button>
                          <button id="clear-sale-btn" class="btn danger"><i class="fas fa-trash"></i> Limpar</button>
                      </div>
                  </div>

                  <div class="pdv-container">
                      <div class="products-panel">
                          <div class="search-bar">
                              <input type="text" id="product-search" placeholder="Buscar produto...">
                              <button id="search-btn"><i class="fas fa-search"></i></button>
                          </div>
                          <div id="products-grid" class="products-grid"></div>
                      </div>

                      <div class="cart-panel">
                          <h3>Carrinho</h3>
                          <div id="cart-items" class="cart-items"></div>
                          <div class="cart-footer">
                              <div class="total">
                                  <span>Total:</span>
                                  <span id="cart-total">R$ 0,00</span>
                              </div>
                              <button id="checkout-btn" class="btn primary" disabled>Finalizar Venda</button>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Tela de Produtos -->
              <div id="produtos-view" class="view">
                  <div class="view-header">
                      <h2>Gestão de Produtos</h2>
                      <div class="actions">
                          <button id="add-product-btn" class="btn primary"><i class="fas fa-plus"></i> Novo
  Produto</button>
                      </div>
                  </div>

                  <div class="table-container">
                      <table id="products-table">
                          <thead>
                              <tr>
                                  <th>Código de Barras</th>
                                  <th>Nome</th>
                                  <th>Preço</th>
                                  <th>Estoque</th>
                                  <th>Ações</th>
                              </tr>
                          </thead>
                          <tbody></tbody>
                      </table>
                  </div>
              </div>

              <!-- Tela de Relatórios -->
              <div id="relatorios-view" class="view">
                  <div class="view-header">
                      <h2>Relatórios</h2>
                  </div>

                  <div class="cards-container">
                      <div class="card">
                          <h3>Exportar Dados</h3>
                          <p>Exporte seus dados para análise ou backup.</p>
                          <div class="card-actions">
                              <button id="export-excel-btn" class="btn"><i class="fas fa-file-excel"></i>
  Excel</button>
                              <button id="export-sql-btn" class="btn"><i class="fas fa-database"></i> SQL</button>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Tela de Configurações -->
              <div id="configuracoes-view" class="view">
                  <div class="view-header">
                      <h2>Configurações</h2>
                  </div>

                  <div class="cards-container">
                      <div class="card">
                          <h3>Backup e Restauração</h3>
                          <p>Faça backup dos seus dados ou restaure a partir de um arquivo.</p>
                          <div class="card-actions">
                              <button id="backup-btn" class="btn primary"><i class="fas fa-download"></i> Fazer
  Backup</button>
                              <button id="restore-btn" class="btn"><i class="fas fa-upload"></i> Restaurar</button>
                              <input type="file" id="restore-file" style="display: none;" accept=".json">
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </main>

      <!-- Scanner de Código de Barras -->
      <div id="scanner-container" class="scanner-container" style="display: none;">
          <div id="scanner-viewfinder" class="scanner-viewfinder"></div>
          <div class="scanner-actions">
              <button id="close-scanner" class="btn danger"><i class="fas fa-times"></i> Fechar</button>
          </div>
      </div>

      <!-- Modal de Produto -->
      <div id="product-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3 id="product-modal-title">Novo Produto</h3>
                  <span class="close">&times;</span>
              </div>
              <div class="modal-body">
                  <form id="product-form">
                      <input type="hidden" id="product-id">
                      <div class="form-group">
                          <label for="product-code">Código de Barras</label>
                          <div class="input-with-button">
                              <input type="text" id="product-code" required>
                              <button type="button" id="scan-product-code" class="btn"><i class="fas
  fa-barcode"></i></button>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="product-name">Nome do Produto</label>
                          <input type="text" id="product-name" required>
                      </div>
                      <div class="form-row">
                          <div class="form-group">
                              <label for="product-price">Preço</label>
                              <input type="number" id="product-price" step="0.01" min="0" required>
                          </div>
                          <div class="form-group">
                              <label for="product-stock">Estoque</label>
                              <input type="number" id="product-stock" min="0" required>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="product-group">Grupo</label>
                          <select id="product-group">
                              <option value="">Selecione...</option>
                              <option value="1">Alimentos</option>
                              <option value="2">Bebidas</option>
                              <option value="3">Limpeza</option>
                              <option value="4">Outros</option>
                          </select>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button id="cancel-product-btn" class="btn">Cancelar</button>
                  <button id="save-product-btn" class="btn primary">Salvar</button>
              </div>
          </div>
      </div>

      <!-- Modal de Pagamento -->
      <div id="payment-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3>Finalizar Venda</h3>
                  <span class="close">&times;</span>
              </div>
              <div class="modal-body">
                  <div class="form-group">
                      <label>Total da Venda</label>
                      <h2 id="payment-total" class="payment-total">R$ 0,00</h2>
                  </div>
                  <div class="form-group">
                      <label for="payment-method">Forma de Pagamento</label>
                      <select id="payment-method">
                          <option value="dinheiro">Dinheiro</option>
                          <option value="cartao_credito">Cartão de Crédito</option>
                          <option value="cartao_debito">Cartão de Débito</option>
                          <option value="pix">PIX</option>
                      </select>
                  </div>
                  <div id="cash-payment" class="form-group">
                      <label for="received-amount">Valor Recebido</label>
                      <input type="number" id="received-amount" step="0.01" min="0">
                      <div class="change-info">
                          <span>Troco:</span>
                          <span id="change-amount">R$ 0,00</span>
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button id="cancel-payment-btn" class="btn">Cancelar</button>
                  <button id="confirm-payment-btn" class="btn primary">Confirmar Pagamento</button>
              </div>
          </div>
      </div>

      <!-- Scripts -->
      <script src="js/db.js"></script>
      <script src="js/barcode.js"></script>
      <script src="js/export.js"></script>
      <script src="js/app.js"></script>
  </body>
  </html>

  Instruções para criar o sistema PDV ORION completo:

  1. Crie uma pasta chamada orion_pdv
  2. Dentro da pasta, crie os seguintes arquivos:
    - index.html (copie o conteúdo acima)
    - login.html (será semelhante à página de login anterior)
    - css/style.css (estilo já fornecido anteriormente)
  3. Crie uma pasta js e adicione os arquivos:
    - js/db.js (cópia do código acima)
    - js/barcode.js (cópia do código acima)
    - js/export.js (cópia do código acima)
    - js/app.js (cópia do código acima)
  4. Para rodar o sistema:
    - Abra login.html em um navegador moderno
    - Use login: admin / senha: admin123
    - Pronto! O sistema já estará funcionando

  Funcionalidades principais:

  1. Scanner de Código de Barras:
    - Use o botão "Scanner" para abrir a câmera
    - Aponte para um código de barras para ler
    - O produto será adicionado automaticamente ao carrinho se existir
    - Se não existir, será oferecida a opção de cadastrar
  2. Cadastro de Produtos:
    - Você pode cadastrar produtos manualmente ou via scanner
    - O scanner pode ser usado tanto no PDV quanto no cadastro
  3. Salvando seu banco de dados:
    - Use a opção "Fazer Backup" na tela de Configurações
    - Isso salvará um arquivo JSON com todos os dados
    - Para restaurar, use a opção "Restaurar"
  4. Exportação para PostgreSQL:
    - Use a opção "SQL" na tela de Relatórios
    - Isso gera um arquivo SQL pronto para importar no PostgreSQL
    - Use este arquivo no psql para migrar seus dados
  5. Exportação para Excel:
    - Use a opção "Excel" na tela de Relatórios
    - Isso gera arquivos CSV para produtos, vendas e itens
    - Abra estes arquivos no Excel para análise

  O sistema funciona 100% offline, mas está preparado para futura migração para PostgreSQL. Os dados são salvos no
  armazenamento local do navegador (LocalStorage) e podem ser exportados a qualquer momento.


> integração google db quero uma exportaçao clonando coms scfipt madanado a meu repositorio do google drive em csv
  acada timeout

  ⎿  Interrupted by user


> esse porjeto novo pra agoogle planilha chemd e indexdb e botatudo completo na plasta esse antigo storage db e salva
   tudo la e dposi fazemospostgreee


● Entendi que você deseja uma integração onde os dados do sistema PDV são exportados automaticamente para o Google
  Drive em formato CSV, além de manter os dados no IndexedDB. Vou criar essa integração para você.

  Vamos implementar:

  1. Exportação automática para Google Sheets/Drive em intervalos regulares
  2. Armazenamento dual usando IndexedDB para persistência local
  3. Backup e exportação para o PostgreSQL futuro

  1. Primeiro, vamos substituir o LocalStorage por IndexedDB para maior capacidade:

  // db.js - Usando IndexedDB em vez de LocalStorage
  const DB = {
      dbName: "orion_pdv_db",
      dbVersion: 1,
      db: null,

      // Inicializa o banco de dados
      init: function() {
          return new Promise((resolve, reject) => {
              const request = indexedDB.open(this.dbName, this.dbVersion);

              request.onerror = event => {
                  console.error("Erro ao abrir banco de dados:", event.target.error);
                  reject(event.target.error);
              };

              request.onsuccess = event => {
                  this.db = event.target.result;
                  console.log("Banco de dados aberto com sucesso");
                  resolve();
              };

              request.onupgradeneeded = event => {
                  const db = event.target.result;

                  // Criar store de produtos
                  if (!db.objectStoreNames.contains('produtos')) {
                      const produtosStore = db.createObjectStore('produtos', { keyPath: 'id', autoIncrement: true });
                      produtosStore.createIndex('codigo_barras', 'codigo_barras', { unique: true });
                      produtosStore.createIndex('nome', 'nome', { unique: false });
                  }

                  // Criar store de vendas
                  if (!db.objectStoreNames.contains('vendas')) {
                      const vendasStore = db.createObjectStore('vendas', { keyPath: 'id', autoIncrement: true });
                      vendasStore.createIndex('data', 'data', { unique: false });
                  }

                  // Criar store de configurações
                  if (!db.objectStoreNames.contains('configuracoes')) {
                      db.createObjectStore('configuracoes', { keyPath: 'id' });

                      // Adicionar configurações iniciais
                      const configStore = event.target.transaction.objectStore('configuracoes');
                      configStore.add({
                          id: 'loja',
                          nome: 'ORION PDV',
                          cnpj: '',
                          telefone: '',
                          endereco: ''
                      });

                      configStore.add({
                          id: 'postgres',
                          host: '34.95.140.152',
                          porta: '5432',
                          banco: 'orion_pdv',
                          usuario: 'orion_app',
                          senha: '123456'
                      });

                      configStore.add({
                          id: 'google',
                          folderID: '',
                          autoExport: true,
                          exportInterval: 30 // minutos
                      });
                  }

                  // Criar store de usuários
                  if (!db.objectStoreNames.contains('usuarios')) {
                      const usuariosStore = db.createObjectStore('usuarios', { keyPath: 'id', autoIncrement: true });
                      usuariosStore.createIndex('username', 'username', { unique: true });

                      // Adicionar usuário padrão
                      usuariosStore.add({
                          username: 'admin',
                          password: 'admin123',
                          nome: 'Administrador',
                          tipo: 'admin'
                      });
                  }
              };
          });
      },

      // Obter todos os produtos
      getProdutos: function() {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['produtos'], 'readonly');
              const store = transaction.objectStore('produtos');
              const request = store.getAll();

              request.onsuccess = event => {
                  resolve(event.target.result);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Buscar produto por código de barras
      getProdutoPorCodigoBarras: function(codigo) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['produtos'], 'readonly');
              const store = transaction.objectStore('produtos');
              const index = store.index('codigo_barras');
              const request = index.get(codigo);

              request.onsuccess = event => {
                  resolve(event.target.result);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Salvar produto
      saveProduto: function(produto) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['produtos'], 'readwrite');
              const store = transaction.objectStore('produtos');
              let request;

              if (produto.id) {
                  request = store.put(produto);
              } else {
                  request = store.add(produto);
              }

              request.onsuccess = event => {
                  produto.id = event.target.result;
                  resolve(produto);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Excluir produto
      deleteProduto: function(id) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['produtos'], 'readwrite');
              const store = transaction.objectStore('produtos');
              const request = store.delete(id);

              request.onsuccess = event => {
                  resolve(true);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Registrar venda
      saveVenda: function(venda) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['produtos', 'vendas'], 'readwrite');
              const vendasStore = transaction.objectStore('vendas');
              const produtosStore = transaction.objectStore('produtos');

              // Adicionar data à venda
              venda.data = new Date().toISOString();

              // Atualizar estoque dos produtos
              let promises = venda.itens.map(item => {
                  return new Promise((resolveItem, rejectItem) => {
                      const getRequest = produtosStore.get(item.produto_id);

                      getRequest.onsuccess = e => {
                          const produto = e.target.result;
                          produto.estoque -= item.quantidade;

                          const putRequest = produtosStore.put(produto);
                          putRequest.onsuccess = () => resolveItem();
                          putRequest.onerror = error => rejectItem(error);
                      };

                      getRequest.onerror = error => rejectItem(error);
                  });
              });

              // Após atualizar o estoque, salva a venda
              Promise.all(promises)
                  .then(() => {
                      const request = vendasStore.add(venda);

                      request.onsuccess = event => {
                          venda.id = event.target.result;
                          resolve(venda);

                          // Aciona exportação automática após venda
                          this.triggerAutoExport();
                      };

                      request.onerror = event => {
                          reject(event.target.error);
                      };
                  })
                  .catch(error => {
                      reject(error);
                  });
          });
      },

      // Obter vendas
      getVendas: function(dataInicio = null, dataFim = null) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['vendas'], 'readonly');
              const store = transaction.objectStore('vendas');
              const request = store.getAll();

              request.onsuccess = event => {
                  let vendas = event.target.result;

                  // Filtrar por data se especificado
                  if (dataInicio || dataFim) {
                      vendas = vendas.filter(venda => {
                          const data = new Date(venda.data);
                          if (dataInicio && data < dataInicio) return false;
                          if (dataFim && data > dataFim) return false;
                          return true;
                      });
                  }

                  resolve(vendas);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Obter configurações
      getConfig: function(id) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['configuracoes'], 'readonly');
              const store = transaction.objectStore('configuracoes');
              const request = store.get(id);

              request.onsuccess = event => {
                  resolve(event.target.result);
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Salvar configurações
      saveConfig: function(config) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['configuracoes'], 'readwrite');
              const store = transaction.objectStore('configuracoes');
              const request = store.put(config);

              request.onsuccess = event => {
                  resolve(config);

                  // Se for configuração do Google, reinicia o timer de exportação
                  if (config.id === 'google') {
                      this.setupAutoExport();
                  }
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Autenticar usuário
      authenticate: function(username, password) {
          return new Promise((resolve, reject) => {
              const transaction = this.db.transaction(['usuarios'], 'readonly');
              const store = transaction.objectStore('usuarios');
              const index = store.index('username');
              const request = index.get(username);

              request.onsuccess = event => {
                  const user = event.target.result;
                  if (user && user.password === password) {
                      resolve(user);
                  } else {
                      resolve(null);
                  }
              };

              request.onerror = event => {
                  reject(event.target.error);
              };
          });
      },

      // Exportar para CSV
      exportToCSV: function() {
          return new Promise(async (resolve, reject) => {
              try {
                  // Obter dados
                  const produtos = await this.getProdutos();
                  const vendas = await this.getVendas();

                  // Produtos CSV
                  let produtosCSV = 'ID,Código de Barras,Nome,Preço,Estoque,Grupo\n';
                  produtos.forEach(p => {
                      produtosCSV += `${p.id},"${p.codigo_barras || ''}","${(p.nome || '').replace(/"/g,
  '""')}",${p.preco_venda || 0},${p.estoque || 0},"${p.grupo_id || ''}"\n`;
                  });

                  // Vendas CSV
                  let vendasCSV = 'ID,Data,Usuário,Forma Pagamento,Valor Total\n';
                  vendas.forEach(v => {
                      vendasCSV += `${v.id},"${v.data || ''}","${v.usuario || ''}","${v.forma_pagamento ||
  ''}",${v.valor_total || 0}\n`;
                  });

                  // Itens de Venda CSV
                  let itensCSV = 'Venda ID,Produto ID,Nome Produto,Quantidade,Preço Unitário,Subtotal\n';
                  vendas.forEach(v => {
                      if (v.itens && Array.isArray(v.itens)) {
                          v.itens.forEach(item => {
                              itensCSV += `${v.id},${item.produto_id || ''},"${(item.nome_produto ||
  '').replace(/"/g, '""')}",${item.quantidade || 0},${item.preco_unitario || 0},${item.subtotal || 0}\n`;
                          });
                      }
                  });

                  resolve({
                      produtos: produtosCSV,
                      vendas: vendasCSV,
                      itens: itensCSV
                  });
              } catch (error) {
                  reject(error);
              }
          });
      },

      // Exportar para Google Sheets
      exportToGoogleSheets: async function() {
          try {
              // Obter configuração do Google
              const googleConfig = await this.getConfig('google');

              // Se não estiver configurado, retorna
              if (!googleConfig || !googleConfig.folderID) {
                  console.log("Google Drive não configurado");
                  return;
              }

              // Obter dados em CSV
              const csvData = await this.exportToCSV();

              // Usar a API do Google para criar/atualizar arquivos
              const timestamp = new Date().toISOString().replace(/[:.]/g, '-');

              // Exporta cada arquivo CSV
              for (const [key, content] of Object.entries(csvData)) {
                  const filename = `orion_pdv_${key}_${timestamp}.csv`;
                  await this.uploadToGoogleDrive(filename, content, googleConfig.folderID);
              }

              console.log("Exportação para Google Drive concluída");
              return true;
          } catch (error) {
              console.error("Erro na exportação para Google Drive:", error);
              return false;
          }
      },

      // Upload para o Google Drive
      uploadToGoogleDrive: function(filename, content, folderId) {
          // Verifica se o Google Drive API está carregado
          if (!window.gapi || !window.gapi.client || !window.gapi.client.drive) {
              console.error("Google Drive API não carregada");
              return Promise.reject("Google Drive API não carregada");
          }

          return new Promise((resolve, reject) => {
              // Primeiro verifica se o arquivo já existe
              window.gapi.client.drive.files.list({
                  q: `name='${filename}' and '${folderId}' in parents and trashed=false`,
                  fields: 'files(id, name)'
              }).then(response => {
                  const files = response.result.files;

                  if (files && files.length > 0) {
                      // Atualiza o arquivo existente
                      const fileId = files[0].id;

                      // Cria o conteúdo do arquivo
                      const blob = new Blob([content], { type: 'text/csv' });
                      const metadata = {
                          mimeType: 'text/csv'
                      };

                      // Upload do conteúdo
                      const form = new FormData();
                      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                      form.append('file', blob);

                      fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`, {
                          method: 'PATCH',
                          headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
                          body: form
                      })
                      .then(res => res.json())
                      .then(success => resolve(success))
                      .catch(error => reject(error));
                  } else {
                      // Cria um novo arquivo
                      const metadata = {
                          name: filename,
                          mimeType: 'text/csv',
                          parents: [folderId]
                      };

                      const blob = new Blob([content], { type: 'text/csv' });

                      const form = new FormData();
                      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                      form.append('file', blob);

                      fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                          method: 'POST',
                          headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
                          body: form
                      })
                      .then(res => res.json())
                      .then(success => resolve(success))
                      .catch(error => reject(error));
                  }
              }).catch(error => {
                  reject(error);
              });
          });
      },

      // Configurar exportação automática
      setupAutoExport: async function() {
          // Limpar timer existente
          if (window.autoExportTimer) {
              clearInterval(window.autoExportTimer);
          }

          try {
              // Obter configuração
              const googleConfig = await this.getConfig('google');

              // Se exportação automática estiver ativada
              if (googleConfig && googleConfig.autoExport) {
                  const interval = (googleConfig.exportInterval || 30) * 60 * 1000; // converter minutos para ms

                  window.autoExportTimer = setInterval(() => {
                      this.exportToGoogleSheets()
                          .then(success => {
                              if (success) {
                                  console.log(`Exportação automática realizada - próxima em
  ${googleConfig.exportInterval} minutos`);
                              }
                          })
                          .catch(error => {
                              console.error("Erro na exportação automática:", error);
                          });
                  }, interval);

                  console.log(`Exportação automática configurada a cada ${googleConfig.exportInterval} minutos`);
              }
          } catch (error) {
              console.error("Erro ao configurar exportação automática:", error);
          }
      },

      // Acionar exportação automática (após vendas)
      triggerAutoExport: async function() {
          try {
              const googleConfig = await this.getConfig('google');

              if (googleConfig && googleConfig.autoExport) {
                  // Espera 5 segundos para não atrapalhar a UI
                  setTimeout(() => {
                      this.exportToGoogleSheets()
                          .then(success => {
                              if (success) {
                                  console.log("Exportação automática após venda realizada com sucesso");
                              }
                          })
                          .catch(error => {
                              console.error("Erro na exportação após venda:", error);
                          });
                  }, 5000);
              }
          } catch (error) {
              console.error("Erro ao verificar config de exportação:", error);
          }
      },

      // Exportar para PostgreSQL (SQL)
      exportToSQL: async function() {
          try {
              const produtos = await this.getProdutos();
              const vendas = await this.getVendas();

              let sql = '-- Exportação do ORION PDV para PostgreSQL\n';
              sql += '-- Data: ' + new Date().toLocaleString() + '\n\n';

              // Produtos
              sql += '-- Produtos\n';
              produtos.forEach(p => {
                  sql += `INSERT INTO produtos (codigo_barras, nome, preco_venda, estoque, grupo_id) VALUES ` +
                        `('${p.codigo_barras || ''}', '${(p.nome || '').replace(/'/g, "''")}', ${p.preco_venda || 0},
   ${p.estoque || 0}, ${p.grupo_id ? p.grupo_id : 'NULL'});\n`;
              });

              // Vendas
              sql += '\n-- Vendas\n';
              vendas.forEach(v => {
                  sql += `INSERT INTO vendas (data, usuario, forma_pagamento, valor_total) VALUES ` +
                        `('${v.data || ''}', '${v.usuario || ''}', '${v.forma_pagamento || ''}', ${v.valor_total ||
  0});\n`;

                  // Itens da venda
                  if (v.itens && Array.isArray(v.itens)) {
                      sql += `-- Itens da venda ${v.id}\n`;
                      v.itens.forEach(item => {
                          sql += `INSERT INTO itens_venda (venda_id, produto_id, quantidade, preco_unitario,
  subtotal) VALUES ` +
                                `(currval('vendas_id_seq'), (SELECT id FROM produtos WHERE codigo_barras =
  '${item.codigo_barras || ''}'), ` +
                                `${item.quantidade || 0}, ${item.preco_unitario || 0}, ${item.subtotal || 0});\n`;
                      });
                  }
              });

              return sql;
          } catch (error) {
              console.error("Erro ao exportar para SQL:", error);
              throw error;
          }
      }
  };

  2. Agora, vamos adicionar a integração com o Google Sheets:

  <!-- Adicione isso no head do seu HTML -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client"></script>

  // google-integration.js
  const GoogleIntegration = {
      API_KEY: 'YOUR_API_KEY', // Obtenha em Google Cloud Console
      CLIENT_ID: 'YOUR_CLIENT_ID', // Obtenha em Google Cloud Console
      SCOPES: 'https://www.googleapis.com/auth/drive.file',
      tokenClient: null,
      isAuthorized: false,

      // Inicialização da API do Google
      init: function() {
          return new Promise((resolve, reject) => {
              gapi.load('client', async () => {
                  try {
                      await gapi.client.init({
                          apiKey: this.API_KEY,
                          discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                      });

                      // Inicializa o token client
                      this.tokenClient = google.accounts.oauth2.initTokenClient({
                          client_id: this.CLIENT_ID,
                          scope: this.SCOPES,
                          callback: (response) => {
                              if (response.error) {
                                  this.isAuthorized = false;
                                  reject(response);
                              } else {
                                  this.isAuthorized = true;
                                  resolve(response);
                              }
                          }
                      });

                      resolve();
                  } catch (error) {
                      reject(error);
                  }
              });
          });
      },

      // Autenticar usuário
      authenticate: function() {
          return new Promise((resolve, reject) => {
              if (!this.tokenClient) {
                  reject(new Error("Google API não inicializada"));
                  return;
              }

              if (gapi.client.getToken()) {
                  this.isAuthorized = true;
                  resolve(true);
              } else {
                  this.tokenClient.requestAccessToken({ prompt: 'consent' });
                  // O callback será chamado quando o usuário autorizar ou negar
              }
          });
      },

      // Sair da conta Google
      signOut: function() {
          const token = gapi.client.getToken();
          if (token) {
              google.accounts.oauth2.revoke(token.access_token);
              gapi.client.setToken(null);
              this.isAuthorized = false;
          }
      },

      // Criar pasta no Google Drive
      createFolder: function(folderName) {
          return new Promise((resolve, reject) => {
              if (!this.isAuthorized) {
                  reject(new Error("Não autorizado"));
                  return;
              }

              const fileMetadata = {
                  name: folderName,
                  mimeType: 'application/vnd.google-apps.folder'
              };

              gapi.client.drive.files.create({
                  resource: fileMetadata,
                  fields: 'id'
              }).then(response => {
                  resolve(response.result.id);
              }).catch(error => {
                  reject(error);
              });
          });
      },

      // Verificar se o folder do ORION existe
      checkOrionFolder: function() {
          return new Promise((resolve, reject) => {
              gapi.client.drive.files.list({
                  q: "name='ORION PDV Data' and mimeType='application/vnd.google-apps.folder' and trashed=false",
                  spaces: 'drive',
                  fields: 'files(id, name)'
              }).then(response => {
                  const files = response.result.files;
                  if (files && files.length > 0) {
                      // Pasta já existe
                      resolve(files[0].id);
                  } else {
                      // Criar nova pasta
                      this.createFolder('ORION PDV Data')
                          .then(folderId => resolve(folderId))
                          .catch(error => reject(error));
                  }
              }).catch(error => {
                  reject(error);
              });
          });
      },

      // Configurar pasta do ORION
      setupOrionFolder: async function() {
          try {
              // Inicializar API
              await this.init();

              // Autenticar usuário
              await this.authenticate();

              // Verificar/criar pasta
              const folderId = await this.checkOrionFolder();

              // Salvar ID da pasta nas configurações
              const googleConfig = await DB.getConfig('google');
              googleConfig.folderID = folderId;
              await DB.saveConfig(googleConfig);

              // Configurar exportação automática
              DB.setupAutoExport();

              return folderId;
          } catch (error) {
              console.error("Erro ao configurar pasta do ORION:", error);
              throw error;
          }
      }
  };

  3. Adicionar tela de configuração do Google Drive no HTML:

  <!-- Adicione isso na seção de configurações -->
  <div class="card">
      <h3>Google Drive</h3>
      <p>Configure a exportação automática para o Google Drive.</p>

      <div id="google-status" class="status-info">
          <p>Status: <span id="google-connection-status">Não configurado</span></p>
      </div>

      <div class="form-group">
          <label for="auto-export">Exportação Automática</label>
          <input type="checkbox" id="auto-export">
      </div>

      <div class="form-group">
          <label for="export-interval">Intervalo (minutos)</label>
          <input type="number" id="export-interval" min="5" value="30">
      </div>

      <div class="card-actions">
          <button id="connect-google-btn" class="btn primary">
              <i class="fab fa-google"></i> Conectar Google Drive
          </button>
          <button id="disconnect-google-btn" class="btn danger" style="display: none;">
              <i class="fas fa-unlink"></i> Desconectar
          </button>
          <button id="export-now-btn" class="btn">
              <i class="fas fa-upload"></i> Exportar Agora
          </button>
      </div>
  </div>

  4. Adicionar configuração no JavaScript:

  // Adicionar no app.js
  function initGoogleIntegration() {
      // Verificar status da conexão
      DB.getConfig('google')
          .then(config => {
              // Atualizar interface
              document.getElementById('auto-export').checked = config.autoExport;
              document.getElementById('export-interval').value = config.exportInterval || 30;

              if (config.folderID) {
                  document.getElementById('google-connection-status').textContent = 'Conectado';
                  document.getElementById('google-connection-status').className = 'connected';
                  document.getElementById('connect-google-btn').style.display = 'none';
                  document.getElementById('disconnect-google-btn').style.display = 'inline-block';
              } else {
                  document.getElementById('google-connection-status').textContent = 'Não configurado';
                  document.getElementById('google-connection-status').className = '';
                  document.getElementById('connect-google-btn').style.display = 'inline-block';
                  document.getElementById('disconnect-google-btn').style.display = 'none';
              }
          })
          .catch(error => {
              console.error("Erro ao carregar configurações do Google:", error);
          });

      // Conectar ao Google Drive
      document.getElementById('connect-google-btn').addEventListener('click', function() {
          GoogleIntegration.setupOrionFolder()
              .then(() => {
                  alert('Conexão com Google Drive realizada com sucesso!');
                  initGoogleIntegration(); // Atualizar interface
              })
              .catch(error => {
                  console.error("Erro ao conectar com Google Drive:", error);
                  alert('Erro ao conectar com Google Drive. Verifique o console para mais detalhes.');
              });
      });

      // Desconectar do Google Drive
      document.getElementById('disconnect-google-btn').addEventListener('click', function() {
          if (confirm('Tem certeza que deseja desconectar do Google Drive?')) {
              GoogleIntegration.signOut();

              DB.getConfig('google')
                  .then(config => {
                      config.folderID = '';
                      return DB.saveConfig(config);
                  })
                  .then(() => {
                      alert('Desconectado do Google Drive com sucesso!');
                      initGoogleIntegration(); // Atualizar interface
                  })
                  .catch(error => {
                      console.error("Erro ao desconectar do Google Drive:", error);
                      alert('Erro ao desconectar. Verifique o console para mais detalhes.');
                  });
          }
      });

      // Exportar agora
      document.getElementById('export-now-btn').addEventListener('click', function() {
          DB.exportToGoogleSheets()
              .then(success => {
                  if (success) {
                      alert('Exportação para Google Drive realizada com sucesso!');
                  } else {
                      alert('Falha na exportação. Verifique se o Google Drive está configurado.');
                  }
              })
              .catch(error => {
                  console.error("Erro na exportação manual:", error);
                  alert('Erro ao exportar. Verifique o console para mais detalhes.');
              });
      });

      // Salvar configurações de exportação
      const saveGoogleConfig = async () => {
          try {
              const config = await DB.getConfig('google');
              config.autoExport = document.getElementById('auto-export').checked;
              config.exportInterval = parseInt(document.getElementById('export-interval').value) || 30;

              await DB.saveConfig(config);
              console.log("Configurações do Google salvas com sucesso");
          } catch (error) {
              console.error("Erro ao salvar configurações do Google:", error);
          }
      };

      document.getElementById('auto-export').addEventListener('change', saveGoogleConfig);
      document.getElementById('export-interval').addEventListener('change', saveGoogleConfig);
  }

  // Adicionar à inicialização
  document.addEventListener('DOMContentLoaded', function() {
      // ... código existente ...

      // Inicializar Google Drive
      initGoogleIntegration();
  });
